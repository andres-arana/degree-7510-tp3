package modelo.acciones;

import modelo.IAccionOferta;
import modelo.IVenta;
import modelo.LineItemProducto;
import modelo.Producto;

import java.util.ArrayList;
import java.util.List;

public class AccionDescontarPorMarca implements IAccionOferta {
	private double descuento;
	private String marca;
	private ArrayList<Producto> excepciones;
	
	public AccionDescontarPorMarca(String marca, List<Producto> excepciones, double descuento) {		
		this.marca = marca;
		this.descuento = descuento;
		this.excepciones = new ArrayList<Producto>();
		if (excepciones != null)
		{
			for (Producto p : excepciones) {
				if (p.getMarca() == marca)
					this.excepciones.add(p);
			}
		}
	}
	@Override
	public void ejecutarAccion(IVenta venta, String detalleOferta) {
		List<LineItemProducto> items = venta.getProductos();
		for (LineItemProducto lineItem : items) {
			int cantidad = lineItem.getCantidad() - lineItem.getProductosConOfertasPorCategoriaOMarcaAplicadas();
			if ((lineItem.getMarcaProducto() == marca) && (cantidad > 0)) {
				boolean noEstaEnLasExcepciones = true;
				for (Producto p : excepciones) {
					if (p.getId() == lineItem.getIdProducto()) {
						noEstaEnLasExcepciones = false;
						break;
					}
				}
				if (noEstaEnLasExcepciones) {
					venta.addOferta(detalleOferta, cantidad, lineItem.montoUnitario() * descuento);
				}
			}			
		}
		venta.marcarTodosLosProductosOfertadosPorMarca(marca, excepciones);
	}

}
